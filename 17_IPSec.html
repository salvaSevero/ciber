
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://salvasevero.github.io/ciber/17_IPSec.html">
      
      
        <link rel="prev" href="14_PPTP.html">
      
      
        <link rel="next" href="16_OpenVPN.html">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>IPSec - CiberSeguridad Redes.</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#l2tpipsec" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="." title="CiberSeguridad Redes." class="md-header__button md-logo" aria-label="CiberSeguridad Redes." data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CiberSeguridad Redes.
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              IPSec
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="CiberSeguridad Redes." class="md-nav__button md-logo" aria-label="CiberSeguridad Redes." data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    CiberSeguridad Redes.
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    WARM UP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            WARM UP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="0_Modelo_Capas.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modelo Capas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="1_ConocimientosBasicos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conocimientos Básicos L2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="3_CAM_Overflow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PoC CAM Overflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="4_ConocimientosL3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conocimientos Básicos L3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="5_TeoriaVLAN.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Teoría VLAN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="6_DHCP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DHCP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="7_ConceptosL4.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conceptos Básicos L4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="8_NAT.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NAT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="9_EnrutamientoDinamico.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enrutamiento Dinámico
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    OFENSIVA
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            OFENSIVA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ARP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            ARP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="21_ARP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ARP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="22_Spoofing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ARP Spoofing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="15_Ataque_PPTP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ataque PPTP
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DEFENSIVA
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            DEFENSIVA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="11_VLANs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VLANs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="10_LACP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    STACK & LACP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="12_VRRP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VRRP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    VPN
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            VPN
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="13_VPN.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conceptos Básicos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="14_PPTP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PPTP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    IPSec
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="17_IPSec.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    IPSec
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#l2tp" class="md-nav__link">
    <span class="md-ellipsis">
      L2TP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ipsec" class="md-nav__link">
    <span class="md-ellipsis">
      IPSec
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ikev1-vs-ikev2" class="md-nav__link">
    <span class="md-ellipsis">
      IKEv1 vs IKEv2
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="16_OpenVPN.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenVPN & Wireguard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="18_DMVPN.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DMVPN
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="20_NGFW.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NGFW
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="19_RADIUS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RADIUS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ANEXO
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            ANEXO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_ProblemasEVE.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Problemas Simulador
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Comandos Cisco
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Comandos Cisco
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="2_ComandosCisco.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comandos Básicos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_ComandosCisco2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comandos Router
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_ComandosNAT.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comandos NAT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_CiscoACL.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ACL
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Configuraciones Mikrotik
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Configuraciones Mikrotik
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_Configuraci%C3%B3nMikrotik.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuración Básica
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_Configurar_PPTP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PPTP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_IPSec.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L2TP/IPSec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_Site_Site_IPSec_RSA.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IPSec Site-to-Site
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_Usuarios.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usuarios EVE-NG
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div><h1 id="l2tpipsec">L2TP/IPSec.<a class="headerlink" href="#l2tpipsec" title="Permanent link">¶</a></h1>
<h2 id="l2tp">L2TP<a class="headerlink" href="#l2tp" title="Permanent link">¶</a></h2>
<p>El protocolo L2TP se encarga de crear un túnel entre los dos extremos (cliente – servidor), dentro del túnel viajarán los datos de la VPN. No obstante L2TP no encripta los datos, por lo que usar L2TP sin IPSec no tiene sentido, pues para ello ya podríamos optar por PPTP (el cual hemos visto que tampoco es seguro).</p>
<p>L2TP es a grandes rasgos muy parecido a PPTP y sufre de los mismos problemas, solo lo vamos a usar para establecer la conexión.</p>
<p>También cabría la posibilida de usar únicamente IPSec.</p>
<h2 id="ipsec">IPSec<a class="headerlink" href="#ipsec" title="Permanent link">¶</a></h2>
<p>El protocolo IPSec se ocupa de encriptar los datos que se transfieren en el túnel L2TP entre el cliente y el servidor VPN. </p>
<p>Su finalidad es la de dotar a la comunicación de:</p>
<ul>
<li>
<p><strong>Confidencialidad</strong>: Nadie pueda leer el contenido al estar cifrado.</p>
</li>
<li>
<p><strong>Integridad</strong>: Nadie pueda modificar el contenido. Esto se consigue al comparar un hash del tráfico enviado.</p>
</li>
<li>
<p><strong>Autenticación</strong>: A través de usuarios/contraseñas/contraseñas compartidas/certificados se garantiza la autenticidad de los extremos.</p>
</li>
<li>
<p><strong>Evitar ataques Replay</strong>: A través del uso de números de secuencia IPSec no permite el reenvío de paquetes duplicados.</p>
</li>
</ul>
<center>
<figure>
  <img src="imagenes/defensiva/29.png" width="500">
</figure>
</center>

<p>Dentro del proceso de IPSec se sigue el protocolo <ins class="critic">IKE (Internet Key Exchange) / ISAKMP (Internet Security Association and Key Management Protocol)</ins> para acordar entre el cliente y el servidor VPN en el tipo de algoritmos de cifrado que se van a implementar en las comunicaciones. </p>
<p><strong>ISAKMP</strong> es un framework, establece el formato de los paquetes y el tipo de mensajes disponibles para establecer/modificar/romper una <ins class="critic">SA (Asociación de Seguridad)</ins>. Un SA es establecido entre dos extremos cuando han llegado a un acuerdo de qué tipo de seguridad (qué tipo de cifrado simétrico, qué algoritmos de hash, si usaran cifrado asimétrico, etc) van a usar para intercambiarse la información y permitir por tanto establecer una seguridad.</p>
<p><strong>IKE</strong> es el protocolo que establece las comunicaciones seguras entre los extremos, para ello hace uso del framework ISAKMP para establecer los SA entre los extremos. Existen dos versiones del protocolo IKEv1 e IKEv2. <mark class="critic">Consta de 2 fases</mark>.</p>
<h3 id="ike-fase-1">IKE Fase 1.<a class="headerlink" href="#ike-fase-1" title="Permanent link">¶</a></h3>
<p>Se negocia los protocolos/algoritmos de encriptación, hashing, autenticación que se van a usar. Una vez decidido se establece una sesión (túnel IKE PHASE 1) entre ambos usando dichos protocolos/algoritmos, creando una SA (Security Association) y procediendo a la autenticación del usuario. </p>
<p>El túnel de la fase 1 se puede establecer en <ins class="critic">modo agresivo o en modo normal</ins>. El modo agresivo envía menos mensajes y es más rápido de conectar, es más inseguro y por tanto no se recomienda, al no ser que en una vpn site-to-site tengan IPs dinámicas en algún extremo.</p>
<h4 id="mensajes-en-fase-1">Mensajes en Fase 1:<a class="headerlink" href="#mensajes-en-fase-1" title="Permanent link">¶</a></h4>
<p>Se envía una propuesta de los parámetros soportados para establecer una SA (<strong>ISAKMP</strong>):</p>
<p>💥 Tipo de autentificación: PSK o Certificado Digital.</p>
<p>💥 Algoritmos Hash: md5, shaX.</p>
<p>💥 Algoritmo de Encriptación Simétrica: 3DES, AES…</p>
<p>💥 Grupos DH soportado: Group 1, 2, 5, 14, 22 …</p>
<p>💥 Lifetime, es decir, tiempo de vida que será válido este túnel de seguridad.</p>
<h4 id="key-generation-information">Key Generation Information:<a class="headerlink" href="#key-generation-information" title="Permanent link">¶</a></h4>
<ul>
<li>
<p>En esta fase se usa DH para generar a partir de un valor público (número primo), un nonce y la clave PSK (Ver apuntes de SSH para repasar el concepto matemático del algoritmo DH):</p>
<p>💥   Una <ins class="critic">clave que sirve para autentificar</ins>.</p>
<p>💥   Una <ins class="critic">clave que sirve para cifrar</ins>.</p>
</li>
</ul>
<h4 id="identify-and-authentication-info">Identify and Authentication Info.<a class="headerlink" href="#identify-and-authentication-info" title="Permanent link">¶</a></h4>
<p>💥   Usando las claves del apartado anterior se autentifica al usuario viendo si tiene la clave precompartida correcta, o similar en el caso de usar certificados digitales.</p>
<center>
<figure>
  <img src="imagenes/defensiva/30.png" width="700">
</figure>
</center>

<h3 id="ike-fase-2">IKE Fase 2.<a class="headerlink" href="#ike-fase-2" title="Permanent link">¶</a></h3>
<p>Una vez establecida la seguridad de la fase 1, se establece una segunda asociación (SA) por cada servicio, en nuestro caso dicho servicio será IPSec. Por tanto, se vuelve a negociar qué protocolos/algoritmos se va a utilizar para establecer la seguridad, en este caso del protocolo IPSec, una vez negociado se crea un segundo túnel que cifrará los datos del cliente.</p>
<center>
<figure>
  <img src="imagenes/defensiva/31.png" width="600">
</figure>
</center>

<p>Entre los parámetros que se negocian están los siguientes:</p>
<ul>
<li>
<p><strong>IPsec Protocol</strong>: AH o ESP</p>
</li>
<li>
<p><strong>Modo de encapsulación</strong>: Modo transporte o túnel.</p>
</li>
<li>
<p><strong>Encriptación</strong>: DES, 3DES o AES.</p>
</li>
<li>
<p><strong>Autentificación</strong>: MD5 or SHA.</p>
</li>
<li>
<p><strong>Lifetime</strong>: Durante cuánto tiempo es válido el túnel, pasado el tiempo se debe renegociar y recrear el túnel de nuevo. </p>
</li>
<li>
<p><strong>DH</strong>: Grupo que se usará junto con la clave compartida PSK + “nonce” certificar  la autenticación y para intercambiar la clave simétrica.</p>
</li>
</ul>
<h3 id="ah-o-esp">AH o ESP:<a class="headerlink" href="#ah-o-esp" title="Permanent link">¶</a></h3>
<p>Son los protocolos que proporcionan seguridad utilizando las algoritmos de cifrado/hash/claves, etc.</p>
<ul>
<li>
<p><strong>AH (Authentication Header)</strong>: Proporciona Integridad y Autenticación.</p>
</li>
<li>
<p><strong>ESP (Encapsulating Security Payload)</strong>: Proporciona Integridad, Autenticación y Confidencialidad.</p>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">AH</p>
<p>Ambos soportan autentificación e integridad, pero <ins class="critic">solo ESP permite encriptación del paquete IP</ins>, por lo que suele ser el elegido de los dos.</p>
</div>
<p>Existen dos modos de configurar estos protocolos, en <ins class="critic">modo transporte o modo túnel</ins>. </p>
<ul>
<li><strong>Modo transporte</strong>: Se saben las IPs que establecen la conexión VPN. Se suele usar cuando queremos dotar de seguridad a un protocolo inseguro (telnet). Es más rápido y tiene menos overhead.</li>
</ul>
<center>
<figure>
  <img src="imagenes/defensiva/32.png" width="600">
</figure>
</center>

<center>
<figure>
  <img src="imagenes/defensiva/33.png" width="600">
</figure>
</center>

<ul>
<li><strong>Modo túnel</strong>: Se enmascara las direcciones que realmente establecen el túnel. Es el modo que se suele usar, aunque al tener que añadir el encabezado para el túnel estamos agregando overhead a nuestros paquetes.</li>
</ul>
<h4 id="ejemplo-ah">Ejemplo AH:<a class="headerlink" href="#ejemplo-ah" title="Permanent link">¶</a></h4>
<center>
<figure>
  <img src="imagenes/defensiva/34.png" width="600">
</figure>
</center>

<h4 id="ejemplo-esp">Ejemplo ESP:<a class="headerlink" href="#ejemplo-esp" title="Permanent link">¶</a></h4>
<center>
<figure>
  <img src="imagenes/defensiva/35.png" width="700">
</figure>
</center>

<center>
<figure>
  <img src="imagenes/defensiva/36.png" width="700">
</figure>
</center>

<h3 id="dh-exchange-key-cifrado-asimetrico">DH Exchange Key (Cifrado Asimétrico):<a class="headerlink" href="#dh-exchange-key-cifrado-asimetrico" title="Permanent link">¶</a></h3>
<p>Permite, a través de cifrado asimétrico, transmitir información de modo seguro, como podría ser la clave simétrica (3DES/AES) que posteriormente cifrará los datos del usuario. </p>
<p>Mediante las claves públicas/privadas de cada extremo, la clave precompartida (PSK) y un “nonce” se genera una clave hash que permite autentificar a los usuarios.</p>
<p>Una vez realizado este último paso ya se tendrá un túnel en el cual se podrá usar de forma segura un cifrado simétrico y además se ha comprobado que el otro extremo es parte del sistema al tener la clave precompartida. Por lo que el tráfico ya va correctamente cifrado y podemos autentificar al usuario/contraseña mediante L2TP (mschap2/chap) pero con IPSeC por encima.</p>
<p>Cuanto más alto el grupo que se use, mayor seguridad a costa de mayor tiempo de computación.</p>
<div class="admonition warning">
<p class="admonition-title">DH Key Group</p>
<p>💥 No usar menos de DH 2048 bits.</p>
<p>💥 Evitar grupos 1, 2, 22, 23 y 24.</p>
</div>
<p>En la fase 2 tenemos la opción de activar <ins class="critic">PFS (Perfect Forward Secrecy)</ins>. Esto obligará a volver a computar otras claves asimétricas de DH diferentes a la de la fase 1.</p>
<h3 id="des-3des-o-aes">DES, 3DES o AES:<a class="headerlink" href="#des-3des-o-aes" title="Permanent link">¶</a></h3>
<p>El principal problema de los cifrados simétricos es como compartir la clave simétrica. Para solventar este problema se ha usado criptografía asimétrica (DH). Una vez compartida la clave simétrica el resto de datos pueden ir cifrados con un algoritmo de cifrado simétrico, esto tiene menor coste computacional y permite un mayor rendimiento. </p>
<div class="admonition warning">
<p class="admonition-title">CIFRADO SIMÉTRICO</p>
<p>💥 DES no es seguro.</p>
<p>💥 Se recomienda el uso de AES 256 bits como mínimo.</p>
</div>
<h3 id="md5-o-sha">MD5 o SHA:<a class="headerlink" href="#md5-o-sha" title="Permanent link">¶</a></h3>
<p>Se usan dichos algoritmos hash para verificar la integridad de los paquetes, confirmar que no hayan sido modificados por nadie. Se recomienda SHA256 como mínimo. </p>
<p>Son algoritmos one-way.</p>
<p>También es usado por AH o ESP para confirmar la autentificación de los usuarios. </p>
<div class="admonition warning">
<p class="admonition-title">MD5 o SHA1</p>
<p>Tanto md5 o sha1 no son seguros.</p>
</div>
<h3 id="servidor-vpn-detras-de-un-nat">Servidor VPN detrás de un NAT.<a class="headerlink" href="#servidor-vpn-detras-de-un-nat" title="Permanent link">¶</a></h3>
<p>Es importante tener en cuenta que este tipo de protocolos pueden tener problemas si el servidor VPN se encuentra detrás de un NAT. Para ello se tiene que:</p>
<ul>
<li>
<p>Activar <ins class="critic">NAT-T (Traversal)</ins> en la parte del servidor.</p>
</li>
<li>
<p>Permitir en el firewall el puerto UDP 4500 para el NAT-T</p>
</li>
<li>
<p>El router del cliente debe tener activado <ins class="critic">VPN Passthrough</ins>, para que deje pasar el tráfico VPN del cliente. En los routers domésticos actuales ya suele venir activado por defecto.</p>
</li>
</ul>
<h3 id="puertos">Puertos.<a class="headerlink" href="#puertos" title="Permanent link">¶</a></h3>
<ul>
<li>
<p>1701: Tráfico L2TP.</p>
</li>
<li>
<p>500: ISAKMP.</p>
</li>
<li>
<p>4500 UDP: NAT-T.</p>
</li>
</ul>
<h2 id="ikev1-vs-ikev2">IKEv1 vs IKEv2<a class="headerlink" href="#ikev1-vs-ikev2" title="Permanent link">¶</a></h2>
<p>Recordemos que existen dos versiones del protocolo IKE.</p>
<p>Entre las principales ventajas de IKEv2 se encuentran las siguientes:</p>
<ul>
<li>
<p>Se elimina el modo agresivo.</p>
</li>
<li>
<p>Mantiene los métodos de negociación mediante PSK como Certificados Digitales (RSA).</p>
</li>
<li>
<p>Usa NAT Transversal por defecto, mientras que en el caso de IKEv1 era una extensión.</p>
</li>
<li>
<p>Permite el uso de EAP.</p>
</li>
<li>
<p>Mayor protección contra ataques de DDoS.</p>
</li>
<li>
<p>Usa menos mensajes para establecer la SA.</p>
</li>
<li>
<p>Mayor soporte a conexiones VPN móviles, que vayan cambiando de lugar sin desconectarse.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">COMPATIBILIDAD</p>
<p><ins class="critic">IKEv2 e IKEv1 no son compatibles</ins>, si configuramos un servidor VPN deberá ser eligiendo una de las dos y nuestros clientes deberán soportar dicha elección.</p>
</div></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Salvador Serrano Pérez - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["header.autohide", "toc.integrate", "toc.follow", "navigation.indexes", "content.code.copy", "navigation.instant", "navigation.instant.progress", "navigation.tracking"], "search": "assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>