
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://salvasevero.github.io/ciber/A_Site_Site_IPSec_RSA.html">
      
      
        <link rel="prev" href="A_IPSec.html">
      
      
        <link rel="next" href="A_Usuarios.html">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>IPSec Site-to-Site - CiberSeguridad Redes.</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ipsec-site-to-site" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="." title="CiberSeguridad Redes." class="md-header__button md-logo" aria-label="CiberSeguridad Redes." data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CiberSeguridad Redes.
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              IPSec Site-to-Site
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="CiberSeguridad Redes." class="md-nav__button md-logo" aria-label="CiberSeguridad Redes." data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    CiberSeguridad Redes.
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    WARM UP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            WARM UP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="0_Modelo_Capas.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modelo Capas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="1_ConocimientosBasicos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conocimientos Básicos L2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="3_CAM_Overflow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PoC CAM Overflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="4_ConocimientosL3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conocimientos Básicos L3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="5_TeoriaVLAN.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Teoría VLAN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="6_DHCP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DHCP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="7_ConceptosL4.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conceptos Básicos L4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="8_NAT.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NAT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="9_EnrutamientoDinamico.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enrutamiento Dinámico
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    OFENSIVA
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            OFENSIVA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ARP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            ARP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="21_ARP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ARP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="22_Spoofing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ARP Spoofing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DHCP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            DHCP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="23_DHCP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DHCP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="24_DHCP_Starvation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Starvation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DDoS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            DDoS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="26_UDP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UDP Flooding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="27_HPing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HPing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="28_Smurf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Smurf
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    SSH
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            SSH
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="29_SSH.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SSH
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="25_Bypass.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bypass
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="15_Ataque_PPTP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ataque PPTP
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DEFENSIVA
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            DEFENSIVA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="11_VLANs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VLANs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="10_LACP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    STACK & LACP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="12_VRRP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VRRP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    VPN
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            VPN
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="13_VPN.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conceptos Básicos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="14_PPTP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PPTP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="17_IPSec.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IPSec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="16_OpenVPN.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenVPN & Wireguard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="18_DMVPN.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DMVPN
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="20_NGFW.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NGFW
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="19_RADIUS.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RADIUS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ANEXO
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            ANEXO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_ProblemasEVE.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Problemas Simulador
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Comandos Cisco
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Comandos Cisco
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="2_ComandosCisco.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comandos Básicos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_ComandosCisco2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comandos Router
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_ComandosNAT.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comandos NAT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_CiscoACL.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ACL
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Configuraciones Mikrotik
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Configuraciones Mikrotik
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_Configuraci%C3%B3nMikrotik.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuración Básica
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_Configurar_PPTP.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PPTP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_IPSec.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L2TP/IPSec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    IPSec Site-to-Site
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="A_Site_Site_IPSec_RSA.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    IPSec Site-to-Site
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objetivo" class="md-nav__link">
    <span class="md-ellipsis">
      Objetivo.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-del-router-cisco" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración del Router Cisco.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-mikrotik" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración Mikrotik.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-de-los-certificados-rsa" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de los Certificados (RSA).
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-de-la-conexion-ipsec" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de la conexión IPSec.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conexion-site-to-site-con-nat" class="md-nav__link">
    <span class="md-ellipsis">
      Conexión Site-to-Site con NAT.
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_Usuarios.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usuarios EVE-NG
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div><h1 id="ipsec-site-to-site">IPSec Site-to-Site.<a class="headerlink" href="#ipsec-site-to-site" title="Permanent link">¶</a></h1>
<h2 id="objetivo">Objetivo.<a class="headerlink" href="#objetivo" title="Permanent link">¶</a></h2>
<p>Crear 2 conexiones IPSec IKEv2 con certificados RSA. </p>
<p>Las redes estarán separadas por un router Cisco que simulará lo que sería Internet.ç</p>
<p>La finalidad es que los equipos Linux se vean entre ellos sin tener el router Cisco ninguna ruta sobre sus redes, además se verá con un traceroute que el salto es directo sin pasar por el Cisco (Internet).</p>
<div class="admonition note">
<p class="admonition-title">GESTIÓN</p>
<p>La red de mantenimiento se usará únicamente para poder gestionar los equipos Mikrotik.</p>
</div>
<center>
<figure>
  <img src="imagenes/anexo/32.png" width="800">
</figure>
</center>

<h2 id="configuracion-del-router-cisco">Configuración del Router Cisco.<a class="headerlink" href="#configuracion-del-router-cisco" title="Permanent link">¶</a></h2>
<ul>
<li>
<p>Levanta las interfaces ➡️ "no shutdown".</p>
</li>
<li>
<p>Configura una IP de la red en cada interfaz ➡️ "ip address IP MÁSCARA".</p>
</li>
<li>
<p>Guarda los cambios ➡️ "write".</p>
</li>
</ul>
<center>
<figure>
  <img src="imagenes/anexo/33.png" width="400">
</figure>
</center>

<h2 id="configuracion-mikrotik">Configuración Mikrotik.<a class="headerlink" href="#configuracion-mikrotik" title="Permanent link">¶</a></h2>
<p>Establecer IP estática en interfaz que conecta con el Cisco</p>
<center>
<figure>
  <img src="imagenes/anexo/34.png" width="700">
</figure>
</center>

<p>Activar el dhcp client en el ether 2 para gestión por winbox.</p>
<center>
<figure>
  <img src="imagenes/anexo/35.png" width="600">
</figure>
</center>

<p>Asignar una IP al puerto LAN (eth3) y al puerto WAN (eth1). Recordad que el puerto eth2 es solo de gestión para que podamos llevar a cabo la configuración.</p>
<center>
<figure>
  <img src="imagenes/anexo/36.png" width="500">
</figure>
</center>

<p>Añadir rutas a los routers para que los peers del túnel IPSec se puedan ver, es decir, que la red 192.168.100.0 y la 192.168.200.0 se vean.</p>
<center>
<figure>
  <img src="imagenes/anexo/37.png" width="600">
</figure>
</center>

<center>
<figure>
  <img src="imagenes/anexo/38.png" width="400">
</figure>
</center>

<div class="admonition warning">
<p class="admonition-title">Conectividad</p>
<p>Comprobar desde los equipos Linux (tinyLinux) que <strong>no llega el ping</strong> entre los hosts (192.168.88.2 y 192.168.89.2).</p>
</div>
<h2 id="creacion-de-los-certificados-rsa">Creación de los Certificados (RSA).<a class="headerlink" href="#creacion-de-los-certificados-rsa" title="Permanent link">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Certificados y Firmas</p>
<p>Vamos a generar y firmar todos los certificados desde un único Mikrotik, de esta forma ahorramos tiempo.</p>
<p>En una situación real se podría generar los certificados en cada router y que lo firmase la CA.</p>
</div>
<h3 id="crear-los-siguientes-certificados-en-el-mikrotik-a">Crear los siguientes certificados en el Mikrotik A.<a class="headerlink" href="#crear-los-siguientes-certificados-en-el-mikrotik-a" title="Permanent link">¶</a></h3>
<ul>
<li>
<p>Certificado firmado del CA (Autoridad Certificadora).</p>
</li>
<li>
<p>Certificado y firma por nuestro propio CA para un Mikrotik A.</p>
</li>
<li>
<p>Certificado y firma por nuestro propio  CA para el otro Mikrotik B.</p>
</li>
</ul>
<center>
<figure>
  <img src="imagenes/anexo/39.png" width="700">
</figure>
</center>

<h3 id="exportar-los-certificados">Exportar los certificados.<a class="headerlink" href="#exportar-los-certificados" title="Permanent link">¶</a></h3>
<ul>
<li>
<p>Certificado CA (no es necesario la firma).</p>
</li>
<li>
<p>Certificado y clave del MikrotikB.  Para ello será necesario asociarle una passphrase/contraseña.</p>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Cómo Exportar</p>
<p>Para exportar los certificados debemos hacer botón derecho sobre el propio certificado ➡️ <strong>Export</strong>. </p>
<p>En el caso que queramos también exportar la clave rellenaremos el passphrase.</p>
<p></p><center>
<figure>
  <img src="imagenes/anexo/40.png" width="400">
</figure>
</center>
</div>
<p>Posteriormente deberemos ir a <mark class="critic">Files</mark> y sacar los 3 ficheros que hemos exportado (el certificado del CA, el certificado para el mikrotik B y la clave del certificado para el mikrotik B). </p>
<div class="admonition tip">
<p><strong>Puedes seleccionar y arrastrar los certificados al escritorio.</strong></p>
</div>
<center>
<figure>
  <img src="imagenes/anexo/41.png" width="700">
</figure>
</center>

<h3 id="importar-los-certificados-en-el-mikrotik-b">Importar los certificados en el Mikrotik B.<a class="headerlink" href="#importar-los-certificados-en-el-mikrotik-b" title="Permanent link">¶</a></h3>
<ul>
<li>
<p>Abre “Files” y arrastra los ficheros desde el escritorio.</p>
</li>
<li>
<p>Abre System ➡️ Certificates y pulsa sobre import.</p>
</li>
</ul>
<div class="admonition note">
<p><strong>En el caso del certificado del Mikrotik B y de su clave deberemos insertar el passphrase.</strong></p>
</div>
<center>
<figure>
  <img src="imagenes/anexo/42.png" width="500">
</figure>
</center>

<div class="admonition warning">
<p><strong>IMPORTANTE QUE TODOS LOS CERTIFICADOS APAREZCAN CON LA SIGLA “T” DE TRUSTED.</strong> </p>
<p><strong>PODEMOS MODIFICARLO HACIENDO DOBLE CLICK SOBRE ELLOS Y MARCANDO LA OPCIÓN.</strong></p>
</div>
<center>
<figure>
  <img src="imagenes/anexo/43.png" width="500">
</figure>
</center>

<h2 id="creacion-de-la-conexion-ipsec">Creación de la conexión IPSec.<a class="headerlink" href="#creacion-de-la-conexion-ipsec" title="Permanent link">¶</a></h2>
<p>Nos vamos a IP  ➡️ IPSec. Dentro de la ventana iremos configurando las diferentes pestañas:</p>
<h3 id="profiles">Profiles.<a class="headerlink" href="#profiles" title="Permanent link">¶</a></h3>
<p>Hace referencia a las opciones posibles para establecer el túnel de la <strong>FASE 1 de IKE</strong>.</p>
<center>
<figure>
  <img src="imagenes/anexo/44.png" width="500">
</figure>
</center>

<h3 id="peer">Peer.<a class="headerlink" href="#peer" title="Permanent link">¶</a></h3>
<p>Identifica la IP del otro extremo, es decir, si estamos configurando el Mikrotik A será la IP del Mikrotik B.</p>
<div class="admonition tip">
<p>Debe ser una IP accesible. En nuestro caso serán las IPs físicas de la WAN que conectan con Internet.</p>
</div>
<center>
<figure>
  <img src="imagenes/anexo/45.png" width="500">
</figure>
</center>

<h3 id="identity">Identity.<a class="headerlink" href="#identity" title="Permanent link">¶</a></h3>
<p>Indicamos en esta sección qué certificados usaremos para aunteticarnos.</p>
<div class="admonition note">
<p>En el ejemplo estamos configurando el router de "Valencia" y presentaremos el certificado de Valencia al Peer "Alicante".</p>
</div>
<center>
<figure>
  <img src="imagenes/anexo/46.png" width="500">
</figure>
</center>

<h3 id="proposal">Proposal.<a class="headerlink" href="#proposal" title="Permanent link">¶</a></h3>
<p>Aquí se indica los protocolos criptográficos de la <strong>FASE 2 de IKE</strong>.</p>
<center>
<figure>
  <img src="imagenes/anexo/47.png" width="500">
</figure>
</center>

<h3 id="policies">Policies.<a class="headerlink" href="#policies" title="Permanent link">¶</a></h3>
<p>Indicamos qué redes se van a compartir y si vamos a usar <strong>modo túnel o transporte</strong>.</p>
<div class="admonition note">
<p>La red <strong>source</strong> será la LAN a la que tendrán acceso a través de la VPN del router que estamos configurando.</p>
<p>La red <strong>destination</strong> será la LAN a la que se tendrá acceso del otro extremo.</p>
</div>
<center>
<figure>
  <img src="imagenes/anexo/48.png" width="500">
</figure>
</center>

<p>También indicaremos que protocolos de cifrado usaremos.</p>
<center>
<figure>
  <img src="imagenes/anexo/49.png" width="500">
</figure>
</center>

<h3 id="comprobaciones">Comprobaciones.<a class="headerlink" href="#comprobaciones" title="Permanent link">¶</a></h3>
<p>Una vez realizado en ambos extremos podremos comprobar en el apartado de Policies que el túnel está <strong>establecido</strong>.</p>
<center>
<figure>
  <img src="imagenes/anexo/50.png" width="700">
</figure>
</center>

<p>Comprobamos desde los hosts que ahora <strong>sí que hay conexión</strong>.</p>
<div class="admonition tip">
<p>En el traceroute no debería aparecer el router Cisco, debe parecer como si estuvieramos en la misma red y la conexión fuese directa.</p>
</div>
<center>
<figure>
  <img src="imagenes/anexo/51.png" width="500">
</figure>
</center>

<h3 id="video-de-ejemplo">Vídeo de Ejemplo.<a class="headerlink" href="#video-de-ejemplo" title="Permanent link">¶</a></h3>
<center>

<iframe width="800" height="400" src="https://www.youtube.com/embed/ST8L5fLHYx4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

</center>

<h2 id="conexion-site-to-site-con-nat">Conexión Site-to-Site con NAT.<a class="headerlink" href="#conexion-site-to-site-con-nat" title="Permanent link">¶</a></h2>
<p>En caso de que las LANs tengan un NAT, tendremos que cambiar la configuración del router/firewall para que el tráfico VPN no sea traducido (NATeado).</p>
<p>Vamos a crear un ambiente más realista y generar la LAN detrás de un NAT.</p>
<h3 id="crear-el-nat-en-las-lans">Crear el NAT en las LANs.<a class="headerlink" href="#crear-el-nat-en-las-lans" title="Permanent link">¶</a></h3>
<p>Para crear un Source NAT, como el que podemos tener en una casa debemos ejecutar en ambos routers Mikrotik una regla:</p>
<p>IP ➡️ Firewall ➡️ NAT ➡️ Add:</p>
<ul>
<li>
<p>Chain: src-nat </p>
</li>
<li>
<p>Action: masquerade (para que haga traducción PAT es decir por puertos).</p>
</li>
<li>
<p>Out Interface: ether1 (es la interfaz WAN).</p>
</li>
</ul>
<h3 id="permitir-trafico-entre-las-redes">Permitir tráfico entre las redes.<a class="headerlink" href="#permitir-trafico-entre-las-redes" title="Permanent link">¶</a></h3>
<div class="admonition tip">
<p>La idea es permitir el tráfico a través de la VPN, para ello crearemos una regla que si detecta que el tráfico viene de la VPN ésta comunicación se hará <strong>sin NAT</strong>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Tabla RAW</p>
<p>Es una tabla donde podemos ver el tráfico de paquetes antes de que hayan realizado el seguimiento de la conexión. </p>
<p>Suele usarse para cortar un DDoS de forma más eficiente puesto que al no haberse realizado el seguimiento de la conexión aún alivia la carga de la CPU.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Tracking</p>
<p>Un seguimiento de la conexión es cuando sabemos que dos ordenadores han establecido una conexión TCP y están pasándose información, al hacer un seguimiento (Tracking) registramos y analizamos los datos de éstos. </p>
<p>En IP ➡️ Firewall ➡️ Connections podemos ver ese seguimiento. </p>
</div>
<center>
<figure>
  <img src="imagenes/anexo/52.png" width="800">
</figure>
</center>

<p>Dentro de la <ins class="critic">tabla RAW</ins> se diferencian dos tipos de tráfico:</p>
<ul>
<li>
<p><strong>PREROUTING</strong>: Tráfico que llega al router y aún no ha sido procesado a través de la tabla de rutas para ver su destino.</p>
</li>
<li>
<p><strong>OUTPUT</strong>: Tráfico originado por el propio router.</p>
</li>
</ul>
<p>Vamos a añadir dos reglas en ambos extremos para que no se realice un track de las conexiones entre las sedes IPSEC.</p>
<p>IP ➡️ Firewall ➡️ Raw ➡️ Add:</p>
<ul>
<li>
<p>Chain: Prerouting.</p>
</li>
<li>
<p>Action: No track.</p>
</li>
<li>
<p>Src Address: LAN_SEDE_A</p>
</li>
<li>
<p>Destination: LAN_SEDE_B</p>
</li>
</ul>
<div class="admonition note">
<p>Volvemos a añadir la misma regla intercambiando los direccionamientos para el tráfico en sentido inverso.</p>
</div>
<center>
<figure>
  <img src="imagenes/anexo/53.png" width="600">
</figure>
</center>

<p>Una vez hecho ya volveremos a tener conectividad a través de la VPN Site-To-Site desde los extremos.</p>
<details class="warning">
<summary>¿Qué problemas podría tener esta solución?</summary>
<p>Al no hacer seguimiento de las conexiones que vienen a través de la VPN tendríamos menos visibilidad si se produjese un ataque de esta red.</p>
</details></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Salvador Serrano Pérez - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["header.autohide", "toc.integrate", "toc.follow", "navigation.indexes", "content.code.copy", "navigation.instant", "navigation.instant.progress", "navigation.tracking"], "search": "assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>