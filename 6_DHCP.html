
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://salvasevero.github.io/ciber/6_DHCP.html">
      
      
        <link rel="prev" href="5_TeoriaVLAN.html">
      
      
        <link rel="next" href="7_ConceptosL4.html">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>DHCP - CiberSeguridad Redes.</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dhcp" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="." title="CiberSeguridad Redes." class="md-header__button md-logo" aria-label="CiberSeguridad Redes." data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CiberSeguridad Redes.
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              DHCP
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="CiberSeguridad Redes." class="md-nav__button md-logo" aria-label="CiberSeguridad Redes." data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    CiberSeguridad Redes.
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UD1. WARM UP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            UD1. WARM UP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="0_Modelo_Capas.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modelo Capas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="1_ConocimientosBasicos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conocimientos Básicos L2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="3_CAM_Overflow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PoC CAM Overflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="4_ConocimientosL3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conocimientos Básicos L3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="5_TeoriaVLAN.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Teoría VLAN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    DHCP
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="6_DHCP.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    DHCP
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mensajes-del-protocolo" class="md-nav__link">
    <span class="md-ellipsis">
      Mensajes del protocolo.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servidor-dhcp-relay" class="md-nav__link">
    <span class="md-ellipsis">
      Servidor DHCP Relay.
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="7_ConceptosL4.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conceptos Básicos L4
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ANEXO
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            ANEXO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_ProblemasEVE.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Problemas Simulador
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="2_ComandosCisco.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comandos Cisco #1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_ComandosCisco2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comandos Cisco Router
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A_Usuarios.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usuarios EVE-NG
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div><h1 id="dhcp"><strong>DHCP.</strong><a class="headerlink" href="#dhcp" title="Permanent link">¶</a></h1>
<ul>
<li>
<p>Permite la asignación automática de direccionamiento IP/máscara/puerta de enlace/servidores DNS.</p>
</li>
<li>
<p>Puertos:</p>
<p>💥 67/UDP (servidor)</p>
<p>💥 68/UDP (cliente)</p>
</li>
<li>
<p>Basado en el protocol “BOOTP”.</p>
</li>
<li>
<p>En wireshark podremos filtrar por “bootp” o “dhcp” para buscar información de estos protocolos.</p>
</li>
</ul>
<center>
<figure>
  <img src="imagenes/warmup/76.png" width="700">
</figure>
  </center>

<h2 id="mensajes-del-protocolo">Mensajes del protocolo.<a class="headerlink" href="#mensajes-del-protocolo" title="Permanent link">¶</a></h2>
<ol>
<li>
<p><mark class="critic">DISCOVER</mark>: El cliente, el cual no tiene IP, manda un mensaje de broadcast (255.255.255.255) con origen (0.0.0.0). El puerto origen 68 (cliente), el puerto destino 67 (servidor).</p>
</li>
<li>
<p><mark class="critic">OFFER</mark>: El mensaje es recibido por todos los equipos de la red, pero sólo el servidor está escuchando en el puerto 67 (UDP), por lo que será éste quien conteste con una oferta, indicando la IP que le ofrece configurarse.</p>
<p>a.  El servidor inserta en su tabla de asignaciones de forma temporal (15 – 60 segundos) la oferta mandada. Es decir, que si en ese tiempo el cliente no confirma la oferta, se libera esa IP de la tabla de asignación.</p>
<p>b.  <ins class="critic">Ejemplo del contenido OFFER</ins>:</p>
</li>
</ol>
<center>
<figure>
  <img src="imagenes/warmup/77.png" width="400">
</figure>
  </center>

<div class="admonition info">
<p class="admonition-title"><strong>INFO</strong></p>
<p>El mensaje OFFER se envía directamente a la IP destino 192.168.0.10, pero el cliente aún no tiene configurada esa IP ¿Cómo le llega el mensaje?</p>
</div>
<details class="warning">
<summary><strong>RESPUESTA</strong></summary>
<p>El servidor tiene su MAC por lo que el paquete le llegará al cliente (se encuentran en la misma red), además lo envía al puerto 68 del cliente, el cual está esperando respuesta tras enviar el DISCOVERY.</p>
</details>
<p><strong>Al ser un mensaje broadcast por parte del cliente lo hace, a priori, muy fácil hacerse pasar por un servidor DHCP falso, pues todos los dispositivos en la red sabrán que está buscando un servidor DHCP</strong></p>
<ol start="3">
<li>
<p><mark class="critic">REQUEST</mark>: El cliente al sopesa la oferta e indica si está de acuerdo con dicha oferta.</p>
</li>
<li>
<p><mark class="critic">ACK</mark>: El servidor confirma el cambio en su tabla de asignaciones y confirma el cambio.</p>
<p>a.  Una vez confirmado el cambio en la tabla de asignaciones estará ahí durante el tiempo estimado en el <ins class="critic">Lease Time</ins> del servidor.</p>
<p>b.  El cliente al recibir el ACK se configura el direccionamiento en su tarjeta.</p>
</li>
</ol>
<h2 id="servidor-dhcp-relay">Servidor DHCP Relay.<a class="headerlink" href="#servidor-dhcp-relay" title="Permanent link">¶</a></h2>
<ul>
<li>
<p>En principio un servicio DHCP asigna direccionamiento IP a equipos dentro de su misma red.</p>
</li>
<li>
<p>Si necesitamos asignar direccionamiento a equipos en redes diferentes necesitamos configurar TODOS los routers intermedios como DHCP Relay, para que cuando reciban un mensaje DISCOVER lo reenvíen al servidor DHCP que se encuentra en otra red, y lo mismo en sentido contrario con el OFFER y el resto de mensajes.</p>
</li>
</ul>
<h3 id="ejemplo">Ejemplo:<a class="headerlink" href="#ejemplo" title="Permanent link">¶</a></h3>
<center>
<figure>
  <img src="imagenes/warmup/78.jpg" width="600">
</figure>
  </center>

<p>En el siguiente ejemplo hay:</p>
<ul>
<li>
<p>Un DHCP Relay configurado en las VLANS 40 y 50</p>
</li>
<li>
<p>Sólo en el puertos Gi1/05 (el te1/0/3 está configurado pero inactivo).</p>
</li>
<li>
<p>Los servidores configurados son 124.167.1.1 y 124.200.1.1.</p>
</li>
</ul>
<p>Por tanto cuando reciba un mensaje con destino 255.255.255.255 al puerto 67, lo reenvía al servidor DHCP 124.167.1.1 y 124.200.1.1.</p>
<div class="admonition warning">
<p class="admonition-title"><strong>CUIDADO</strong></p>
<p>En caso de que para llegar a dichos servidores DHCP tenga que pasar por otros routers, dichos routers intermedios también tendrán que tener configurado dicho servicio DHCP Relay.</p>
</div></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Salvador Serrano Pérez - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["header.autohide", "toc.integrate", "navigation.indexes", "content.code.copy"], "search": "assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>